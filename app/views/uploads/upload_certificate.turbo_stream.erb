<%= turbo_stream.replace "certificate_form_#{@certificate_type.id}" do %>
  <div class="accordion-body" id="certificate_form_<%= @certificate_type.id %>">
    <div class="alert alert-success mb-3">
      <i class="fas fa-check-circle me-1"></i>
      Certificate uploaded successfully!
    </div>
    <%= render partial: "certificate_form", locals: {
      certificate_type: @certificate_type,
      certificate: @certificate,
      certificate_request: @certificate_request
    } %>
  </div>
<% end %>

<%= turbo_stream.replace "certificate_item_#{@certificate_type.id}" do %>
  <div class="accordion-item" id="certificate_item_<%= @certificate_type.id %>">
    <h2 class="accordion-header">
      <button class="accordion-button"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapse_<%= @certificate_type.id %>">
        <div class="d-flex align-items-center gap-3 w-100">
          <% requirement = MatrixRequirement.find_by(vessel: @crew_member.vessel, role: @crew_member.role, certificate_type: @certificate_type) %>
          <% if requirement&.mandatory? %>
            <span class="badge bg-danger">M</span>
          <% else %>
            <span class="badge bg-warning text-dark">O</span>
          <% end %>

          <div class="flex-fill">
            <span class="fw-medium"><%= @certificate_type.name %></span>
            <span class="text-muted ms-2">(<%= @certificate_type.code %>)</span>
          </div>

          <span class="badge bg-warning">Uploaded - Pending Review</span>
        </div>
      </button>
    </h2>
    <div id="collapse_<%= @certificate_type.id %>"
         class="accordion-collapse collapse show"
         data-bs-parent="#certificatesAccordion">
      <div class="accordion-body" id="certificate_form_<%= @certificate_type.id %>">
        <div class="alert alert-success mb-3">
          <i class="fas fa-check-circle me-1"></i>
          Certificate uploaded successfully!
        </div>
        <%= render partial: "certificate_form", locals: {
          certificate_type: @certificate_type,
          certificate: @certificate,
          certificate_request: @certificate_request
        } %>
      </div>
    </div>
  </div>
<% end %>
