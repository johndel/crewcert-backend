<%= form_with model: [:admin, certificate], class: "needs-validation" do |f| %>
  <% if certificate.errors.any? %>
    <div class="alert alert-danger">
      <ul class="mb-0">
        <% certificate.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= f.label :crew_member_id, "Crew Member", class: "form-label" %>
    <%= f.collection_select :crew_member_id, CrewMember.includes(:vessel, :role).ordered, :id, ->(cm) { "#{cm.full_name} (#{cm.vessel.name} - #{cm.role.name})" }, { prompt: "Select a crew member" }, class: "form-select #{'is-invalid' if certificate.errors[:crew_member].any?}", required: true %>
  </div>

  <div class="mb-3">
    <%= f.label :certificate_type_id, "Certificate Type", class: "form-label" %>
    <%= f.collection_select :certificate_type_id, CertificateType.ordered, :id, :display_name, { prompt: "Select a certificate type" }, class: "form-select #{'is-invalid' if certificate.errors[:certificate_type].any?}", required: true %>
  </div>

  <div class="row">
    <div class="col-md-6 mb-3">
      <%= f.label :issue_date, class: "form-label" %>
      <%= f.date_field :issue_date, class: "form-control #{'is-invalid' if certificate.errors[:issue_date].any?}" %>
    </div>
    <div class="col-md-6 mb-3">
      <%= f.label :expiry_date, class: "form-label" %>
      <%= f.date_field :expiry_date, class: "form-control #{'is-invalid' if certificate.errors[:expiry_date].any?}" %>
    </div>
  </div>

  <div class="mb-3">
    <%= f.label :document, class: "form-label" %>
    <%= f.file_field :document, class: "form-control", accept: "image/*,.pdf" %>
    <div class="form-text">Upload a scanned copy of the certificate (PDF or image)</div>
  </div>

  <div class="d-flex gap-2">
    <%= f.submit "Save Certificate", class: "btn btn-primary" %>
    <%= link_to "Cancel", certificate.persisted? ? admin_certificate_path(certificate) : admin_certificates_path, class: "btn btn-outline-secondary" %>
  </div>
<% end %>
