<div class="card">
  <div class="card-header">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h5 class="card-title mb-0">Review Queue</h5>
        <% if @pending_count > 0 %>
          <small class="text-muted"><%= @pending_count %> certificates pending review</small>
        <% end %>
      </div>
      <div class="d-flex gap-2">
        <%= link_to "All", admin_certificates_path, class: "btn btn-sm #{params[:filter].blank? ? 'btn-primary' : 'btn-outline-secondary'}" %>
        <%= link_to "Pending", admin_certificates_path(filter: 'pending'), class: "btn btn-sm #{params[:filter] == 'pending' ? 'btn-primary' : 'btn-outline-secondary'}" %>
        <%= link_to "Verified", admin_certificates_path(filter: 'verified'), class: "btn btn-sm #{params[:filter] == 'verified' ? 'btn-primary' : 'btn-outline-secondary'}" %>
        <%= link_to "Expiring", admin_certificates_path(filter: 'expiring'), class: "btn btn-sm #{params[:filter] == 'expiring' ? 'btn-primary' : 'btn-outline-secondary'}" %>
      </div>
    </div>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th>Crew Member</th>
            <th>Certificate</th>
            <th>Status</th>
            <th>Issue Date</th>
            <th>Expiry Date</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @certificates.each do |certificate| %>
            <tr>
              <td>
                <%= link_to certificate.crew_member.full_name, admin_crew_member_path(certificate.crew_member), class: "text-decoration-none" %>
              </td>
              <td><%= certificate.certificate_type.display_name %></td>
              <td>
                <% case certificate.status %>
                <% when 'pending' %>
                  <span class="badge bg-warning">Pending</span>
                <% when 'processing' %>
                  <span class="badge bg-info">Processing</span>
                <% when 'verified' %>
                  <span class="badge bg-success">Verified</span>
                <% when 'rejected' %>
                  <span class="badge bg-danger">Rejected</span>
                <% end %>
              </td>
              <td><%= certificate.issue_date&.strftime("%b %d, %Y") || "-" %></td>
              <td>
                <% if certificate.expiry_date %>
                  <% if certificate.expired? %>
                    <span class="text-danger fw-medium"><%= certificate.expiry_date.strftime("%b %d, %Y") %> (Expired)</span>
                  <% elsif certificate.expiring_soon? %>
                    <span class="text-warning fw-medium"><%= certificate.expiry_date.strftime("%b %d, %Y") %></span>
                  <% else %>
                    <%= certificate.expiry_date.strftime("%b %d, %Y") %>
                  <% end %>
                <% else %>
                  -
                <% end %>
              </td>
              <td class="text-end">
                <div class="btn-group btn-group-sm">
                  <%= link_to admin_certificate_path(certificate), class: "btn btn-outline-secondary" do %>
                    <i class="fas fa-eye"></i>
                  <% end %>
                  <% if certificate.status.in?(%w[pending processing]) %>
                    <%= button_to verify_admin_certificate_path(certificate), method: :post, class: "btn btn-outline-success" do %>
                      <i class="fas fa-check"></i>
                    <% end %>
                    <%= button_to reject_admin_certificate_path(certificate), method: :post, class: "btn btn-outline-danger", data: { turbo_confirm: "Are you sure you want to reject this certificate?" } do %>
                      <i class="fas fa-times"></i>
                    <% end %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
          <% if @certificates.empty? %>
            <tr>
              <td colspan="6" class="text-center text-muted py-4">No certificates found.</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  <% if @pagy.pages > 1 %>
    <div class="card-footer">
      <%= pagy_bootstrap_nav(@pagy) %>
    </div>
  <% end %>
</div>
